// remove italic effect for <em> ( ** in markdown ) in order to easily assign class to inline text
// use .i to reobtain italic for <em>
em:not(.i) { &[class], &[r], &[t] { font-style: normal; }}

// sizes ================================

:root    { --s: 1; }

.big     { --s: 1.25; }
.bigger  { --s: 1.5; }
.small   { --s: .75; }
.smaller { --s: .5; }

.size, .big, .bigger, .small, .smaller { &:not(h1, h2, h3, h4, h5, h6, .fake) { font-size: calc(var(--s) * 1em); } }

@mixin titleSizeMod { &.size, &.big, &.bigger, &.small, &.smaller { font-size: calc(var(--size) * var(--s) * 1em); } }

// headings and fake headings ( and sizing ) ================================

$size-h1: 2;
$size-h2: 1.6;
$size-hrest: 1.2;
// $size-h3: 1.25;
// $size-h4: 1.25;
// $size-h5: 1.25;

// sizing headings and fake headings ( e.g. use <h1>, .fake.h1 with .big )
@mixin titleSize($id, $size) {

    h#{$id} {font-size: #{$size}em;}

    h#{$id}, .fake.h#{$id} {
        font-size: $size + em ;
      --size: #{$size};
        @include titleSizeMod;
    } 
}

                      @include titleSize(1, $size-h1);
                      @include titleSize(2, $size-h2);
@for $i from 3 to 7 { @include titleSize($i, $size-hrest); }

// alignment ================================

// inline elements are converted to block level element

.l, .c, .r {
    --ofs: 0;
    position: relative;
    display: block;
    width: 100%;
    transform: translateX(--ofs);
}

// left
.l {
    text-align: left;
    left:0
}

// center
.c {
    text-align: center;
}

// right
.r {
    text-align: right;
    right: 0;

    &::after {
        white-space: pre
    }
}

// maximize width to page width for block level elements
// which contains children with alignment 
p, h1, h2, h3, h4, h5, h6 { &:has(>.c), &:has(>.r) { width: 100%; } }

// lines ================================

@mixin txtline($type) {
    text-decoration: $type { color: var(--lc); thickness: var(--lt) } ;
    &.-d  { text-decoration: dashed $type { color: var(--lc); thickness: var(--lt); }; }
    &.-do { text-decoration: dotted $type { color: var(--lc); thickness: var(--lt); }; }
    &.-db { text-decoration: double $type { color: var(--lc); thickness: var(--lt); }; }
    &.-w  { text-decoration: wavy   $type { color: var(--lc); thickness: var(--lt); }; }
}

       .u       { @include txtline(underline)                         }
     .ovl       { @include txtline(overline)                          }
del, .del       { @include txtline(line-through)                      }        
   .u.ovl       { @include txtline(underline overline)                }
del, .del { &.u { @include txtline(line-through underline)          }
          &.ovl { @include txtline(line-through overline)           }
        &.u.ovl { @include txtline(line-through underline overline) } }

// color presets ================================

@mixin colors($varName: clr) {
    &w, &white   { --#{$varName}: #FFFFFF; }
        &silver  { --#{$varName}: #C0C0C0; }
        &gray    { --#{$varName}: #808080; }
    &b, &black   { --#{$varName}: #000000; }
    &r, &red     { --#{$varName}: #FF0000; }
        &maroon  { --#{$varName}: #800000; }
        &yellow  { --#{$varName}: #FFFF00; }
        &olive   { --#{$varName}: #808000; }
        &lime    { --#{$varName}: #00FF00; }
        &green   { --#{$varName}: #008000; }
        &aqua    { --#{$varName}: #00FFFF; }
        &teal    { --#{$varName}: #008080; }
        &blue    { --#{$varName}: #0000FF; }
        &navy    { --#{$varName}: #000080; }
        &fuchsia { --#{$varName}: #FF00FF; }
        &purple  { --#{$varName}: #800080; }
} 

// text highlight (background) and border sizing
.h, .b {
    &w, &b, &r, &white, &silver, &gray, &black, &red, &maroon, &yellow, &olive, &lime, &green, &aqua, &teal, &blue, &navy, &fuchsia, &purple {
        position: relative; 
        z-index: 1;

        &::before {content: ""; 
            position: absolute; 
            --bd: 0.02em;
            z-index: -1;
            left:   calc(-.2em + var(--bd)*-1);
            right:  calc(-.2em + var(--bd)*-1);
            top:            calc(var(--bd)*-1);
            bottom:         calc(var(--bd)*-1);
        }
    }
}

// colors
.c {
    @include colors;
    &w, &white, &silver, &gray, &b, &black, &r, &red, &maroon, &yellow, &olive, &lime, &green, &aqua, &teal, &blue, &navy, &fuchsia, &purple
        { color: var(--clr) !important; }
}

// highlight (background) colors
.h {
    background-color: #ff0; // default yellow highlight
    @include colors(clrh);
    &w, &white, &silver, &gray, &b, &black, &r, &red, &maroon, &yellow, &olive, &lime, &green, &aqua, &teal, &blue, &navy, &fuchsia, &purple 
        { &::before { background-color: var(--clrh); }; }
}

// border colors

.b {
    @include colors(clrb);
    &w, &white, &silver, &gray, &b, &black, &r, &red, &maroon, &yellow, &olive, &lime, &green, &aqua, &teal, &blue, &navy, &fuchsia, &purple 
        { &::before { --bw: 2px; border: var(--clrb) solid var(--bw); }; }
}

// ruby (拼音) ================================

// use *character*{:r="ruby"} inside markdown
[r] {
    position: relative;
    display: inline-block;
    // width: max-content;
    text-align: center;

    &::before { content: attr(r);
    // pos
        position: relative;
        left: 50%; 
        transform: translateX(-50%);
        display: block;
    // styl
        font-size: .75em;
    }
}

// tip ================================

// use *content*{:t="tip"} inside markdown
[t] { text-decoration: dotted underline;
    &::before { content: attr(t); }
}

// reveal url for hyperlinks
.content a { &::before { content: "转到："attr(href) attr(t); } }

// // reveal id for headings
// h1[id], h2[id], h3[id], h4[id], h5[id], h6[id] { &::before { content: "#" attr(id);
//     font-size: max(.5em, 15px);
// } }

// h1[id], h2[id], h3[id], h4[id], h5[id], h6[id],
[t], a {
    position: relative;

    &::before {
        transition: .2s .4s;
        pointer-events: none;
    // pos
        position: absolute;
        left: 0 ;
        top: .5em;
        z-index: 10;
    // size 
        width: fit-content;
    // styl
        padding: .2em .5em;
        background: var(--pgColor);
        opacity: 0;
    }

    &:hover::before {
        transition: 0s;
        top: 1.5em;
        opacity: 1;
    }

    // tip coloring
    & { --tc: var(--txtColor);
        &::before {
            color: var(--tc);
            border: var(--tc) solid 2px;
            box-shadow: 4px 4px var(--tc);
        }
    }
}

a {
    &::before {
        transition: .2s;
        position: fixed;
        bottom: 0; top: unset;
    }

    &:hover::before {
        top: unset;
    }
}

// tip above 

// h1[id], h2[id], h3[id], h4[id], h5[id], h6[id], 
.above[t] {
    &::before { bottom: .5em; top: unset; }
    &:hover::before { bottom: 1.5em; }
}

// full width link
a.ab {
    display: block;
    right: 0;
    text-decoration: none;
    transition: 0s .2s;

    &::after { transition: opacity .2s .2s;
        inset: -.2em 0;
        box-sizing: border-box;
        border: {
            bottom: 3px solid;
            image: linear-gradient(90deg, var(--txtColor-link), #0000) 1;
        };
        opacity: 0;
    }

    &:hover {
        transition: 0s;
        padding-left: .5em;
        letter-spacing: .2em;

        &::after {
            transition: 0s;
            opacity: 1;
        }
    }
}

// table ================================

table {
    --tbc: var(--txtColor); --tbtc: var(--txtColor);
// pos
position: relative;
z-index: 1;
//styl
    color: var(--tbtc);
    border-collapse: collapse;
    margin-block: 1em;

    &::before, td, th { padding-block: .2em; padding-inline: .5em; }

    &[h]::before { content: attr(h); 
        position: relative;
        display: table-caption;
        bottom: -1px;
    }

    // inline table
    &.i { display: inline-table; }

    // default table
    &.t {
        box-shadow: 2px 2px var(--tbc);
    // border 
        thead, tbody, td:first-child, tfoot { border: 2px solid { color: var(--tbc); }; }
        td:first-child { border-block-width: 0; }
        &::before, thead, td:first-child { font-weight: bolder; text-align: center; }

        tr:nth-child(even) td:not(:first-child) {
            position: relative;
            &::before { content: "";
                position: absolute;
                inset: 0;
                z-index: -1;
                background: var(--tbc);
                opacity: .3;
            }
        }

        &::before {
            background: var(--tbc);
            color: var(--pgColor);
            box-shadow: 2px 2px var(--tbc);
        }
    }

    // simple table
    &.ts {
    // border 
        thead, tbody, tr :first-child, tfoot { border: 0 solid { color: var(--tbc); }; }
        thead                          { border-bottom-width: 2px; }
        tbody:not(:first-child), tfoot { border-top-width:    2px; }
        tr :first-child                { border-right-width:  2px; }

        &::before {
            padding-block: .5em;
            font-weight: bolder;
            text-align: center;    
        }
    }
}

// blocks ================================

.content>blockquote, :not(blockquote) >blockquote { margin-block: 2em; }

blockquote {
    >p:first-child { margin-top: 0; } >p:last-child { margin-bottom: 0; } // revome extra margin for first and last children blockquote 
    margin-right: 1em;

    // inform block
    &.info, &.note, &.warn {
        display: table;
        position: relative;
        padding-inline: 2.5em .5em;
        padding-block: .5em;
        margin-left: 0;

        &::before {
            position: absolute;
            left: 0;
            top: .37em;
            padding-inline: .5em;
            font-size: 1.2em;
        }

        >blockquote { margin-left: 0; } // remove default left margin
    }

    // information block
    &.info {
        background: var(--txtColor-fade);
        border: var(--txtColor) 3px solid;
        box-shadow: 4px 4px var(--txtColor);
    
        &::before { content: "ⓘ"; }
    }

    &.note {
        background: var(--txtColor-green-fade);
        border: var(--txtColor-green) 3px solid;
        box-shadow: 4px 4px var(--txtColor-green);
        color: var(--txtColor-green);
    
        &::before { content: "ⓘ"; }
    }

    // warning block
    &.warn {
        background: var(--txtColor-red-fade);
        border: var(--txtColor-red) 3px solid;
        box-shadow: 4px 4px var(--txtColor-red);
        color: var(--txtColor-red);
    
        &::before { content: "⚠";
            top: .3em;
            font-size: 1.4em;
            font-weight: normal;
            padding-inline: .4em;
        }
    }

    // cascading layer block ( unnecessarily complex )
    &.layer {
        &, blockquote:not([class]) {
            transition: border-color .4s;
            padding: .5em;
            box-shadow: -3px 0 var(--txtColor);
            border: #0000 3px solid { left-width: 0px; };

            &:hover {
                transition: border-color 0s;
                border-color: var(--txtColor);
            }
        }

        &, >blockquote:not([class]) {
            &:hover {
                box-shadow: -3px 0 var(--txtColor), 3px 3px var(--txtColor);
            }
        }

        blockquote:not([class]) { margin: 0 .3em; }
    }
}


/* ================ F A N C Y ================ */

// mimic text-stroke using text-shadow ================================

$text-stroke-shadow: 
    calc(-1 * var(--std))                      0  var(--stc), // l
    calc(-1 * var(--std))  calc(-1 * var(--std))  var(--stc), // lt
                       0   calc(-1 * var(--std))  var(--stc), // t
         calc(var(--std))  calc(-1 * var(--std))  var(--stc), // rt
         calc(var(--std))                      0  var(--stc), // r
         calc(var(--std))       calc(var(--std))  var(--stc), // rb
                       0        calc(var(--std))  var(--stc), // b
    calc(-1 * var(--std))       calc(var(--std))  var(--stc); // lb 

// rainbow ================================

.rainbow {
    --rspd: 1s; --rbgsz: 4em;
    &, *, ::before {
        image-rendering: pixelated;
        background: url(/assets/image/rainbowDither.png), url(#{$ghprxy}/assets/image/rainbowDither.png) {size: var(--rbgsz)};
        background-clip: text;
        -webkit-background-clip: text;
        color: #0000;

        animation: rainbowScroll var(--rspd) linear infinite;
        @keyframes rainbowScroll {
            0% { background-position: 0; }
            100% { background-position: var(--rbgsz); }
        }
    }

    // rainbow but with cyam magenta yellow color scheme
    &.cmy, &.cmy * {
        background-image: url(/assets/image/rainbowDither_.png), url(#{$ghprxy}/assets/image/rainbowDither_.png) ;
    }
}

// rainbow with stroke and shadow really cool
.rainbow.fancy {
    --rs: .1em; --rsc: var(--txtColor-sat);
    filter: 
        drop-shadow(.05em -.05em var(--rsc)) 
        drop-shadow(-.05em .05em var(--rsc)) 
        drop-shadow(var(--rs) var(--rs) var(--rsc));
}

// .rainbow.fancy but with rainbowing shadows
.rainbow.fancy2 {
    --rs: .1em; --rsc: var(--txtColor-sat);
    filter: 
        drop-shadow(.05em .05em var(--txtColor-sat)) 
        drop-shadow(.1em .1em var(--pgColor)) 
        drop-shadow(.1em .1em #dd4)
        drop-shadow(.1em .1em #4dd)
        drop-shadow(.1em .1em #d4d)
        drop-shadow(.05em -.05em var(--rsc)) 
        drop-shadow(-.05em .05em var(--rsc)) 

}

// shadow

.shadow {
    --sdd: 8px; --sdc: var(--txtColor-plain);
    text-shadow: 1px 1px var(--pgColor), var(--sdd) var(--sdd) var(--sdc);
    padding-bottom: .2em;
}

// echo ================================

// unnecessarily complex

@mixin echo($horizontal, $vertical) { // echo
    text-shadow: 
        // calc( 2px * $horizontal) calc( 2px * $vertical) var(--pgColor),
        calc(.1em * $horizontal) calc(.1em * $vertical) #44d8,
        calc(.2em * $horizontal) calc(.2em * $vertical) #44d4,
        calc(.3em * $horizontal) calc(.3em * $vertical) #44d2;
}
@mixin echoStroke($horizontal, $vertical) { // echo with text troke
    text-shadow: 
        $text-stroke-shadow,
        // calc( 2px * $horizontal) calc( 2px * $vertical) var(--pgColor),
        calc(.1em * $horizontal) calc(.1em * $vertical) #44d8,
        calc(.2em * $horizontal) calc(.2em * $vertical) #44d4,
        calc(.3em * $horizontal) calc(.3em * $vertical) #44d2;
}
@mixin echorb($horizontal, $vertical) { // rainbow echo
    text-shadow: 
        calc(.05em * $horizontal) calc(.05em * $vertical) #d44,
        calc(.1em  * $horizontal) calc(.1em  * $vertical) #dd4,
        calc(.15em * $horizontal) calc(.15em * $vertical) #4dd,
        calc(.2em  * $horizontal) calc(.2em  * $vertical) #d4d,
}
@mixin echorbStroke($horizontal, $vertical) { // rainbow echo with stroke
    text-shadow: 
        $text-stroke-shadow,
        calc(.05em * $horizontal) calc(.05em * $vertical) #d44,
        calc(.1em  * $horizontal) calc(.1em  * $vertical) #dd4,
        calc(.15em * $horizontal) calc(.15em * $vertical) #4dd,
        calc(.2em  * $horizontal) calc(.2em  * $vertical) #d4d,
}

.echo       { @include echo(1, 1);
    padding-bottom: .8em;
    
    &-down  { @include echo(0, 1);
        padding-bottom: .8em;
    }

    &-up    { @include echo(0, -1);
        padding-top: .8em;
    }

    &-right { @include echo(1, 0);
        padding-right: .8em;
    }

    &-left  { @include echo(-1, 0);
        padding-left: .8em;
    }
}

// echo rainbow
.echorb     { @include echorb(1, 1);
    padding-bottom: .8em;

    &-down  { @include echorb(0, 1);
        padding-bottom: .8em;
    }

    &-up    { @include echorb(0, -1);
        padding-top: .8em;
    }

    &-right { @include echorb(1, 0);
        padding-right: .8em;
    }

    &-left  { @include echorb(-1, 0);
        padding-left: .8em;
    }
}

// stroke ================================

.stroke {
    --std: 1px; --stc: var(--txtColor);
    color: var(--pgColor);
    text-shadow: $text-stroke-shadow;

    &.shadow {
        text-shadow: $text-stroke-shadow, var(--sdd) var(--sdd) var(--sdc);
    }

    &.echo      { @include echoStroke(1, 1);
        &-down  { @include echoStroke(0, 1); }
        &-up    { @include echoStroke(0, -1); }
        &-right { @include echoStroke(1, 0); }
        &-left  { @include echoStroke(-1, 0); }
    }

    &.echorb    { @include echorbStroke(1, 1);
        &-down  { @include echorbStroke(0, 1); }
        &-up    { @include echorbStroke(0, -1); }
        &-right { @include echorbStroke(1, 0); }
        &-left  { @include echorbStroke(-1, 0); }
    }
}

// animate ================================

// rotate

.rotate {
    --rspd: 4s; --ofst-x: 0%; --ofst-y: 0%; --rphs: 0; --rheit: 2em;
// pos
    display: inline-block;
    transform-origin: 
        calc( 50% + var(--ofst-x))
        calc( 50% + var(--ofst-y));
// size
    width: max-content;
// styl
    margin-block: calc(var(--rheit)/2);
    padding: 0;
// ani
    animation: rotate var(--rspd) linear calc(var(--rspd) * var(--rphs) * -1) infinite;

    &.rev { animation-direction: reverse; }

    &.c {
        transform: translateY(50%);
        animation-name: rotateCentered; 
        left: 50%; transform: translateX(-50%);
    }

    @keyframes rotate {
        0%   { transform: rotate(0); }
        100% { transform: rotate(360deg); }
    }

    @keyframes rotateCentered {
        0%   { transform: translateX(-50%) rotate(0); }
        100% { transform: translateX(-50%) rotate(360deg); }
    }
}

// pulse

.pulse {
    --pspd: .25s; --pscl: 1.2; --pphs: 0;
    
    // .rotate & { --pscl: 1.5 }

    display: inline-block;

    // sizing
    font-size: calc(var(--pscl) * var(--s) * 1em) !important;
    @mixin faketitle-pulseSize($id, $size) { &.fake.h#{$id} { font-size: calc(var(--pscl) * $size * 1em) !important; } }
                          @include faketitle-pulseSize(1, $size-h1);
                          @include faketitle-pulseSize(2, $size-h2);
    @for $i from 3 to 7 { @include faketitle-pulseSize($i, $size-hrest); }

    animation: pulse var(--pspd) ease-out calc(var(--pspd) * var(--pphs) * -1) infinite alternate;
    @keyframes pulse {
        0% { scale: calc(1 / var(--pscl)); }
        100%   { scale: 1; }
    }
}